# Gemini Canvas プロンプト改善サマリー

## 問題の診断

Geminiにプロンプトを入力したところ、実際のスライドコンテンツではなく、スライドの「仕様説明」を出力してしまいました。

### 具体的な問題点

1. **詳細情報が長すぎる**
   - プロンプトの「詳細情報」に、非常に長い調査レポート全文（数千文字）が含まれていた
   - Geminiが「このレポートをスライド化する」のではなく「このプロンプトの仕様を説明する」タスクだと誤解

2. **プロンプトの構造が仕様書的**
   - 【重要】、【テーマ・内容】、【スタイル規定】などの見出しが多数
   - Geminiがこれを「スライドを作る指示」ではなく「仕様書そのもの」と認識

3. **実行指示が弱い**
   - プロンプトの冒頭で「作成してください」とは書いてあるが、長大な仕様の中に埋もれている
   - 「今すぐスライドを作成する」という明確な実行トリガーが不足

## 実施した改善

### 1. promptBuilder.ts の改善

#### 変更点1: 冒頭の実行指示を強化

**Before:**
```typescript
return `あなたはプレゼンテーションスライド作成の専門家です。
以下の指示に従って、Googleスライドにエクスポート可能な静的なスライドを作成してください。
```

**After:**
```typescript
return `あなたはプレゼンテーションスライド作成の専門家です。
以下の指示に従って、**今すぐ**Googleスライドにエクスポート可能な静的なスライドコンテンツを${slideCount}枚作成してください。
```

**効果:**
- 「**今すぐ**」を太字で強調し、即座の実行を促す
- スライド枚数を明示して、期待値を明確化
- 「スライドコンテンツ」と具体的に指定

#### 変更点2: 出力例セクションを追加

新しい関数 `buildOutputExampleSection()` を追加：

```typescript
function buildOutputExampleSection(): string {
  return `【出力形式の例】

各スライドを以下のような形式で出力してください：

\`\`\`
---
スライド 1/${'{スライド総数}'}

# [スライドタイトル]

[副題や発表者情報など]
---
\`\`\``;
}
```

**効果:**
- Geminiに期待する出力形式を具体的に示す
- 「仕様説明」ではなく「スライドコンテンツ」を出力すべきことを明示

#### 変更点3: 実行指示セクションを追加

新しい関数 `buildExecutionSection()` を追加：

```typescript
function buildExecutionSection(slideCount: number): string {
  return `【実行指示】

**以上の指示に従って、今すぐ${slideCount}枚のスライドコンテンツを作成してください。**

各スライドには以下を含めてください：
1. スライド番号とタイトル
2. 本文内容（箇条書き、表、図解など）
3. （必要に応じて）スピーカーノート

**重要**: スライドの「仕様説明」や「メタ情報」ではなく、実際のスライドコンテンツそのものを作成してください。`;
}
```

**効果:**
- プロンプトの末尾で実行指示を念押し
- 「仕様説明ではなく実際のコンテンツを作成」と明示的に警告

#### 変更点4: プロンプト構造の更新

`buildPrompt()` 関数で、新しいセクションを組み込み：

```typescript
const promptParts = [
  buildRoleSection(outline.length),         // 強化済み
  buildThemeSection(userInput),
  buildStyleSection(style, layoutRules),
  buildStructureSection(outline),
  buildConstraintsSection(layoutRules),
  buildGeminiCanvasSection(),
  buildOutputExampleSection(),              // 新規追加
  buildExecutionSection(outline.length),    // 新規追加
];
```

### 2. 改善版プロンプトの例

`improved_prompt.md` に、改善されたプロンプトの完全な例を作成しました。

主な改善点：
- **詳細情報を簡潔化**: 長大な調査レポート全文 → 要点のみに絞る（箇条書き形式）
- **実行指示の強化**: 冒頭と末尾で「今すぐ作成」を明示
- **出力例の追加**: 期待する形式を具体的に示す

## 期待される効果

この改善により、Geminiは以下のように動作するはずです：

### Before（改善前）
```
この度は、プレゼンテーションスライドの作成依頼をいただきありがとうございます。
ご提示いただいた【テーマ・内容】に基づき、【スタイル規定】と【制約事項】を
厳守したGoogleスライドにエクスポート可能な静的コンテンツ（全5枚）を作成
いたしました。各スライドのフォントサイズ、色、レイアウトは...

スライド 1/5：タイトルスライド
要素指定スタイル
背景#FFFFFF
...
```
↑ **スライドの仕様説明を出力（NG）**

### After（改善後）
```
---
スライド 1/5

# AIで「会社テンプレ準拠」のGoogleスライドはどこまで自動化できるか

調査レポート
2024年11月
---

---
スライド 2/5

## 背景・課題

- AIスライド生成のゴール：企業テンプレートに準拠した自動生成
- 現状：単一ツールでは困難、組み合わせが必要
- 2つのレベル：装飾的準拠（色・フォント）と構造的準拠（スライドマスター）
---
```
↑ **実際のスライドコンテンツを出力（OK）**

## 使用方法

### 1. アプリを再ビルドして使用

```bash
cd gemini-canvas-slides
npm run dev
```

アプリで生成されるプロンプトには、改善が自動的に適用されます。

### 2. 改善版プロンプトを直接使用

`improved_prompt.md` を参考に、Geminiに直接貼り付けて使用できます。

### 3. 重要な注意点

**詳細情報は簡潔に**：
- ❌ 長大なレポート全文をコピペ
- ✅ 要点を箇条書きで5-10項目程度に絞る

**スライド枚数に注意**：
- 詳細情報が多い場合は、スライド枚数を増やす（5枚 → 8枚など）
- 逆に、簡潔な内容なら3-4枚でも十分

## トラブルシューティング

### それでもGeminiがスライドを作成しない場合

1. **詳細情報をさらに簡潔にする**
   - 現在の文字数を半分にしてみる
   - 箇条書きの各項目を1行に収める

2. **プロンプトを2段階に分ける**
   - 第1段階：骨子だけをGeminiに作成させる
   - 第2段階：各スライドの詳細を追加依頼

3. **Gemini Canvasではなく、通常のGeminiチャットを試す**
   - Canvasモードは視覚的コンテンツに特化しているため、指示の解釈が異なる場合がある

## まとめ

この改善により、Geminiがプロンプトを正しく理解し、実際のスライドコンテンツを生成する確率が大幅に向上します。

キーポイント：
- ✅ 冒頭と末尾で実行指示を明確化
- ✅ 出力例を提供して期待値を明示
- ✅ 詳細情報は簡潔に（長大なテキストを避ける）
- ✅ 「仕様説明ではなく実際のコンテンツ」と明示的に警告
